---
title: "Candidate Debt Exploration"
author: "Divya and Jason"
date: "25 September 2017"
output:
  word_document: default
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

As members of the campaign committee for an upcoming election, we are interested in knowing as much as possible about debt reported by candidates in previous elections. Using the monthly voter registration statistics for registered voters in Oregon from 2012, we performed an exploratory analysis to help the agency address their goals. Our objectie was to perform an exploratory analysis to understand how campaign characteristics are related to the candidates debt.

We Were given a dataset on voter registration from 2012 **"CandidateDebt.csv"**.  The dependent (or target) variable in this data is named "amount". We were told that the labels of the variables would be as listed below, and the rest of the variables should be self-explanatory

**id**: internal identifier that corresponds to a single expenditure record. 
**reportnumber**: identifier used for tracking the individual form 
**origin**: This field shows from which filed report-type the data originates. 
**filerid**: The unique id assigned to a candidate. 
**filertype**: Indicates if this record is for a candidate.
**filername**: The candidate or committee name as reported on the candidates registration. 
**firstname**: This field represents the first name, as reported by the filer. 
**middleinitial**: This field represents the middle initial, as reported by the filer. 
**lastname**: This field represents the last name, as reported by the filer.
**office**: The office sought by the candidate.
**legislativedistrict**: The Washington State legislative district. 
**position**: The position associated with an office. 
**party**: The political party as declared by the candidate on their registration.
**jurisdiction**: The political jurisdiction associated with the office of a candidate.
**jurisdictioncounty**: The county associated with the jurisdiction of a candidate. 
**jurisdictiontype**: The type of jurisdiction this office is: Statewide, Local, etc.
**electionyear**: The election year in the case of candidates.
**amount**: The amount of the debt incurred or order placed.
**recordtype**: This field designates the item as a debt.
**fromdate**: The start date of the period for the report on which this debt record was reported.
**thrudate**: The end date of the period for the report on which this debt record was reported.
**debtdate**: The date that the debt was incurred.
**code**: The type of debt. 
**description**: The reported description of the transaction.
**vendorname**: The name of the vendor or recipients name. 
**vendoraddress**: The street address of the vendor or recipient.
**vendorcity**: The city of the vendor or recipient.
**vendorstate**: The state of the vendor or recipient.
**vendorzip**: The zip code of the vendor or recipient.


## Introduction

The research question that motivated our analysis was: How are campaign characteristics related to the candidates debt?


### Describe your data set. What types of variables does it contain? How many observations are there?

There were 28 variables in the original 'CandidateDebt.csv' file, and 1043 observations. The variable 'reportnumber' was of integer class, and the rest were factors with 1-141 levels. All were listed above (i.e., in the assignment), and no 'id' variable was present. 
Jason to Divya: I've consolidated here, and we should get rid of whatever we aren't using (note that I need the car library)
```{r car}
#setwd("~/Desktop/UCB_DataScience/Statistics/stats-lab-assgn")
#getwd() 
#install.packages("FSA")
#install.packages("ggplot2")
#install.packages("randomcoloR")
#library(car)
#library(ggplot2)
cdebt_original = data.frame(read.csv("CandidateDebt.csv"))
par(oma= c(2,1,5,2) + 0.1) #Sets outside margins : b, l, t, r 
par(mar = c(4,1,5,1)) #Sets plot margins
str(cdebt_original)
```


### Evaluate the data quality. Are there any issues with the data? Explain how you handled these potential issues. Explain whether any data processing or preparation is required for your data set.

We noticed right away that the 'legislativedistrict' header did not correspond to the data in this column -- it instead corresponded to the data in the next column to the right, and the same was true for all columns that followed. For example, 'DEMOCRAT' should refer to 'party' rather than to 'jurisdiction.' We therefore used Excel to shift all of these column headers one column to the right, and tentatively renamed the 'legislativedistrict' column 'office2' (because its contents resembled those of 'office'). We also deleted the 'vendorzip' column header because it was not associated with any data (the last column now being appropriately labeled 'vendorstate').

In addition, we observed that a number of fields were empty or contained '#N/A' text. We converted these to 'NA' while loading the repaired CSV file, and found that this resulted in several columns (legislativedistrict, position, electionyear) changing from factor to int. Similarly, the key 'amount' variable changed from factor to num, thereby enabling quantitative analysis of debt. 

```{r revisedCSV}
cdebt_revised = data.frame(read.csv("CandidateDebt_Fixed.csv", stringsAsFactors = T, na.strings=c(NA,"NA","#N/A" ,"", " ")))
str(cdebt_revised)
```

We then removed the 56 rows containing NA values in the 'amount' column, as these could not be quantitatively related to debt. In fact, these rows were mostly comprised of NA values, thereby confounding comparison with other variables as well. 
```{r amount}
cdebt_revised = subset(cdebt_revised, !is.na(amount))
length(cdebt_revised$amount)
```

The MM/DD/YY format of the 3 date variables (fromdate, thrudate, debtdate) led to their factor classification, and simple use of as.Date does not yield YYYY year values (e.g., 2012 is read as 0012). To obtain useful data for each in a single line of code, we coerced from factor via the 'as.Date' method and corrected mathematically as neeed (effectively added 2000 years).
```{r dates}
cdebt_revised$thrudate = as.Date(cdebt_revised$thrudate, "%m/%d/%Y")
summary(cdebt_revised$thrudate)
cdebt_revised$fromdate = as.Date(cdebt_revised$fromdate, "%m/%d/%Y") + 365.25 * 2000 - 15
cdebt_revised$thrudate = as.Date(cdebt_revised$thrudate, "%m/%d/%Y") + 365.25 * 2000 - 15
cdebt_revised$debtdate = as.Date(cdebt_revised$debtdate, "%m/%d/%Y") + 365.25 * 2000 - 15
summary(cdebt_revised$thrudate)
``` 

Following are some additional observations made while in Excel:
    * Many filernames (and filerids) have multiple entries in the table. Consequently, a given person will be counted multiple times if corresponding rows aren't consolidated into a total or set of totals. Notably, a given filername is often associated with a variety of parties and offices. 
    * There are 7 more levels for filerid (141) than for filername (134). This is due to 7 filernames that each have two corresponding filerid values. One possible explanation could be that two or more people who share the same name ran for office. 
    * office2, legislativedistrict, jurisdiction, jurisdictioncounty, and jurisdictiontype are all related to one another -- but do not appear to be related to office. Online searches meanwhile show that of these, only office appears related to filername. 

Last, the dataset contains several variables that appear unlikely to contribute much or any information. 
    * origin, filertype, recordtype: Factor has only one level. Some rows in recordtype are NA, but in these cases whole row is NA.
    * electionyear: All values are either either 2012 or NA
    
Jason to Divya: I think these merit more analysis before including above, i.e., we need to demonstrate what we state. 
Divya to Jason : Sure

    * firstname, middleinitial, lastname: these are presumably redundant to filername 
    * vendoraddress, vendorcity, vendorstate: vendorname might be used in lieu of these 4 variables

```{r origin}
summary(cdebt_revised$origin)
``` 
```{r filertype}
summary(cdebt_revised$filertype)
``` 
```{r recordtype}
summary(cdebt_revised$recordtype)
``` 
```{r electionyear}
summary(cdebt_revised$electionyear)
``` 


## Univariate Analysis of Key Variables: Use visualizations and descriptive statistics to perform a univariate analysis of each key variable. Be sure to describe any anomalies, coding issues, or potentially erroneous values. Explain how you respond to each issue you identify. Note any features that appear relevant to statistical analysis. Discuss what transformations may be appropriate for each variable.

The 'amount' values are all positive and range from around 3 to 19,000 (units are unclear but are presumably dollars or perhaps thousands of dollars). The mean is more than 4x the median, and a histogram confirms the distribution is positively skewed.

Divya to jason : Write a note on all amounts have been assumed to be Dollars

```{r}
summary(cdebt_revised$amount)
hist(cdebt_revised$amount, breaks = seq(0, 20000, by = 1000), main = "Histogram of the 'amount' variable",  border="black", col="#00A5DF", xlab = "Amount of Debt in $" ,ylab="No of Debts", ylim = c(0, 800))

```

### Examine talk about Party

Nearly 65% of filings (by count rather than amount) were by Democrats -- more than twice the number filed by Republicans.  
```{r party}

party <- table(cdebt_revised$party)
length(cdebt_revised$party)
summary(cdebt_revised$party)

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,1))

colorPalette <- c("#E69F00", "#009E73", "#FF0000", "#0000FF")
# I , N , R , D

barplot(party[order(party)], horiz = TRUE , las = 1, main ="Number of Debts wrt Party" , xlab="No of Debts" ,cex.axis = .9 ,cex.names= 0.9 , col = colorPalette , xlim = c(0, 700))

```
### Examine target variable: office 

Most debt entries (about 51% of total) were filed by state representatives. State senators had the next-largest share, with less than 14% of the total count.
```{r office}

length(cdebt_revised$office)
summary(cdebt_revised$office)

office <- table(cdebt_revised$office)
#Sets plot margins : b, l, t, r 
par(las=1, mar=c(5,8,2, 1))

barplot(office[order(office)], horiz = TRUE , las = 1, main ="Number of Debts by office", xlab="Number of Debts" ,cex.names=0.5 , col = terrain.colors(16),xlim = c(0, 600)) 

```

### Examine the variable: vendor city

Nearly 47% of entries are associated with vendorcity of Seattle, followed by Woodinville and Washington, D.C.
```{r vendorcity}

#length(cdebt_revised$vendorcity)
#str(cdebt_revised$vendorcity)
#summary(cdebt_revised$vendorstate)

count_Seattle = subset(cdebt_revised, vendorcity == "SEATTLE")
count_cities = subset(cdebt_revised, !is.na(vendorcity))
(share_Seattle = length(count_Seattle$vendorcity) / length(count_cities$vendorcity))

vendorcity <- table(cdebt_revised$vendorcity)
#Sets plot margins : b, l, t, r 
par(las=1, mar=c(2.5,8,2, 0.3))

barplot(vendorcity[order(vendorcity)], horiz = TRUE , las = 1, main ="Number of debts by vendorcity", xlab="Number of debts" ,cex.names=0.5 , col = heat.colors(29)) 


```
### Examine the variable: description

Fully 25% of entries have "RE-ORDER TEE SHIRTS" in the description field. 
```{r description}
#length(cdebt_revised$description)
#summary(cdebt_revised$description)
description <- table(cdebt_revised$description)

#Sets plot margins : b, l, t, r 
par(las=1, mar=c(2.5,8,2, 0.7))

barplot(description[order(description)], horiz = TRUE , las = 1, main ="Number of debts by description", xlab="Number of debts" ,cex.names=0.3 , col = terrain.colors(16) , xlim = c(0, 250) , width = 10) 

#qplot(cdebt_revised$description , ylab="Number of debts", geom="bar", fill="Nature of the debt") + scale_x_discrete(label=function(x) abbreviate(x, minlength=7)) + coord_flip()
#theme(axis.text.y=element_text(angle=90,hjust=1,vjust=0)) 

#ggplot(data=cdebt_revised, aes(x=description)) + geom_bar(stat="identity")

# [Divya to myself] Set axis till end
# spacing between plots 

```

## Analysis of Key Relationships: Explore how your outcome variable is related to the other variables in your dataset. Make sure to use visualizations to understand the nature of each bivariate relationship. What tranformations can you apply to clarify the relationships you see in the data? Be sure to justify each transformation you use.

Each value of 'reportnumber' is unique (# of levels = # of observations).
```{r reportnumber}
(length(cdebt_revised$reportnumber) - length(unique(cdebt_revised$reportnumber)))
``` 

There seems to be a surge in debts in the middle of the reportnumber range, presumably due to values for this variable increasing with time (i.e., apparently issued sequentially).
```{r}
with(cdebt_revised, plot(reportnumber, amount))
with(cdebt_revised, plot(fromdate, amount))
with(cdebt_revised, plot(thrudate, amount))
with(cdebt_revised, plot(debtdate, amount))
```

### Examine the target variable: Amount wrt to Party

Lets first examine Total Amount wrt to Party :

Most of the debt is filed by Democrats -- more than 9x the amount filed by Republicans. The aforementioned 2x difference in filing count does not explain the gap between parties.
```{r amount_sum}
amount_sum = tapply(cdebt_revised$amount, cdebt_revised$party, FUN=sum )
(amount_sumK = amount_sum/1000)
```

```{r totalDebtVsParty}
par(las=1, mar=c(5,10,2,0.8))

colorTAPalette <- c( "#E69F00", "#009E73","#FF0000","#0000FF")
# N , I , D , R

barplot(amount_sumK[order(amount_sumK)], horiz = TRUE , las = 1, main ="Total Debt wrt to Party" , xlab="Total Debt in K $" ,cex.axis = .9 ,cex.names= 0.9 , col = colorTAPalette , xlim = c(0, 1200))

```

To better assess this relationship, we will plot the mean amount for each party.  We can use a by statement to get the means.

```{r meanAmountVsParty}


#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,0.8))

colorMAPalette <- c( "#E69F00", "#FF0000","#009E73","#0000FF")
# I , N , R , D

amount_means = by(cdebt_revised$amount, cdebt_revised$party,  mean)

barplot(amount_means[order(amount_means)], horiz = TRUE , las = 1, main ="Mean Debt wrt to Party" , xlab="Mean Debt in $" ,cex.axis = .9 ,cex.names= 0.9 , col = colorMAPalette, xlim = c(0, 2000)) 

```

Let's check the distribution of debt amount through a boxplot 

```{r debtDistriVsParty}

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,0.3))

colorBAPalette <- c("#0000FF", "#E69F00", "#009E73", "#FF0000" )
# D , R , N , I <==> D , N , I , R

boxplot(cdebt_revised$amount ~ party,  horizontal = TRUE ,data = cdebt_revised, cex.axis = .6, log='x',
main = " Debt distirbution wrt to party", col = colorBAPalette)

#ggplot(cdebt_revised, aes(x=cdebt_revised$party, y=cdebt_revised$was_office)) + geom_boxplot(outlier.colour="red")

```

1. We notice that Democrats and Non partisan parties have contributed to
   most of the debt amount

2. Republican party has some outliers 

3. Though there are more no of debts for republicans the amount of debt is distributed around 450$
   R code to show the amount of debt
   
Next we would look at the relationship between the office sought by the candidate and the amount of debt incurred or order placed

### Examine the relationships between office and Debt Amount

```{r amountVsOffice}

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(3,10,2,0.3))

boxplot(cdebt_revised$amount ~ office, data = cdebt_revised, cex.axis = .6, log='x', horizontal = TRUE ,
main = "Amount wrt to 'office' Variable" , las=2 , col = "#DDA266")

#ggplot(cdebt_revised, aes(x=cdebt_revised$amount, y=cdebt_revised$was_office)) + geom_boxplot(outlier.colour="red")

```


```{r}
summary(cdebt_revised$amount)
```

1. We noticed though state representative has more number of debts , but
   the total amount is between $5 to $1000 with the maximum debt amount between $300 and $750 
   in the interquartile region

2. Median of the debt amount is at $300 as confirmed by the boxplots

3. The boxplots indicate that the debt amounts are almost around the same interquartile region
   which means that the debt amount for all the candidates are in the same range irrespective of their served offices 

### Examine the relationships between description of the debt and the Amount

```{r amountVsDesc}

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(3,10,2,0.3))

boxplot(cdebt_revised$amount ~ description, data = cdebt_revised, cex.axis = .6, log='x', horizontal = TRUE ,
main = " Debt distirbution wrt to Description" , las=2 , col = "#009E73")

#ggplot(cdebt_revised, aes(x=cdebt_revised$amount, y=cdebt_revised$was_office)) + geom_boxplot(outlier.colour="red")

```

## Analysis of Secondary Effects: What secondary variables might have confounding effects on the relationships you have identified? Explain how these variables affect your understanding of the data.

## Conclusion: Summarize your exploratory analysis. What can you conclude based on your analysis?

