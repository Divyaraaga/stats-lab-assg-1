---
title: "Candidate Debt Exploration"
author: "Divya"
date: "17 September 2017"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

As a member of the campaign committee for an upcoming election, you are interested in knowing as much as possible about debt reported by candidates in previous elections. Using the monthly voter registration statistics for registered voters in Oregon from 2012, perform an exploratory analysis to help the agency address their goals.

Jason to Divya: Not sure what you're doing here. I think we should restore the text originally included in the assignment. 

Perform an exploratory analysis to understand 
\begin{center}
How campaign characteristics are related to the candidates debt. 
\end{center}

Dataset on voter registration from 2012 **"CandidateDebt.csv"**.  
The dependent (or target) variable in this data is named "amount".

The labels of some of the variables are listed below; the rest of the variables should be self-explanatory.

**id **:  internal identifier that corresponds to a single expenditure record. <br />
**reportnumber** : identifier used for tracking the individual form. <br />
**origin** : This field shows from which filed report-type the data originates. <br />
**filerid** : The unique id assigned to a candidate.  <br />
**filertype** : Indicates if this record is for a candidate. <br />
**filername**: The candidate or committee name as reported on the candidates registration. <br />
**firstname** : This field represents the first name, as reported by the filer. <br />
**middleinitial** : This field represents the middle initial, as reported by the filer. <br />
**lastname**: This field represents the last name, as reported by the filer. <br />
**office** : The office sought by the candidate. <br />
**position** : The position associated with an office. <br />
**legislativedistrict** : The Washington State legislative district. <br />
**was_party**: Should get the value from ryan . <br />
**party** : The political party as declared by the candidate on their registration. <br />
**jurisdiction** : The political jurisdiction associated with the office of a candidate. <br />
**jurisdictioncounty **: The county associated with the jurisdiction of a candidate.
**jurisdictiontype** : The type of jurisdiction this office is: Statewide, Local, etc. <br />
**electionyear** : The election year in the case of candidates. <br />
**amount** : The amount of the debt incurred or order placed. <br />
**recordtype** : This field designates the item as a debt. <br />
**fromdate** : The start date of the period for the report on which this debt record was reported.  <br />
**thrudate** : The end date of the period for the report on which this debt record was reported.  <br />
**debtdate** : The date that the debt was incurred.  <br />
**code** :The type of debt.  <br />
**description** : The reported description of the transaction.  <br />
**vendorname** : The name of the vendor or recipient???s name.  <br />
**vendoraddress** : The street address of the vendor or recipient.  <br />
**vendorcity** : The city of the vendor or recipient.  <br />
**vendorstate **: The state of the vendor or recipient.  <br />
**vendorzip **: The zip code of the vendor or recipient.  <br />

## Objective: Perform an exploratory analysis to understand how campaign characteristics are related to the candidates debt. 


## Introduction: State the research question that motivates your analysis.

How are campaign characteristics related to the candidates debt?


### Setup

Jason to Divya: Leaving this alone for now, except note that I've commented-out the wd because it defaults to folder containing RMD file. 
We first load the car library, which gives us a convenient scatterplotMatrix function.
```{r car}
#setwd("~/Desktop/UCB_DataScience/Statistics/stats-lab-assgn")
#getwd() 

#install.packages("FSA")
#install.packages("ggplot2")
#install.packages("randomcoloR")

library(car)
#library(ggplot2)
```


#### Load the dataset found in the file, **"CandidateDebt.csv"**

```{r load}
cdebt_original = data.frame(read.csv("CandidateDebt.csv"))

#Sets outside margins : b, l, t, r 
par(oma= c(2,1,5,2) + 0.1)

#Sets plot margins
par(mar = c(4,1,5,1))

```


#### Describe your data set. What types of variables does it contain? How many observations are there?

There were 28 variables in the original 'CandidateDebt.csv' file, and 1043 observations. The variable 'reportnumber' was of integer class, and the rest were factors with 1-141 levels. All were listed above (i.e., in the assignment), and no 'id' variable was present. 
```{r variables}
str(cdebt_original)
```



#### Evaluate the data quality. Are there any issues with the data? Explain how you handled these potential issues. Explain whether any data processing or preparation is required for your data set.

We noticed right away that the 'legislativedistrict' header did not correspond to the data in this column -- it instead corresponded to the data in the next column to the right, and the same was true for all columns that followed. For example, 'DEMOCRAT' should refer to 'party' rather than to 'jurisdiction.' We therefore used Excel to shift all of these column headers one column to the right, and renamed the 'legislativedistrict' column 'office2' (because its contents resembled those of 'office'). We also deleted the 'vendorzip' column header because it was not associated with any data (the last column now being appropriately labeled 'vendorstate').

In addition, we noticed that a number of fields were empty or contained '#N/A' text. We converted these to 'NA' while loading the repaired CSV file, and found that this resulted in several columns (legislativedistrict,position,electionyear) changing from factor to int. Similarly, the key 'amount' variable changed from factor to num, thereby enabling quantitative analysis of debt. 

```{r variables}
cdebt_all = read.csv("CandidateDebt_Fixed.csv", stringsAsFactors = T, na.strings=c(NA,"NA","#N/A" ,"", " "))
str(cdebt_all)
```

The MM/DD/YY format of the 3 date variables (fromdate, thrudate, debtdate) led to their factor classification, and simple use of as.Date does not yield YYYY year values (e.g., 2012 is read as 0012). To obtain useful data for each in a single line of code, we coerced from factor via the 'as.Date' method and corrected mathematically as neeed (effectively added 2000 years).
```{r dates}
cdebt_original$thrudate = as.Date(cdebt_original$thrudate, "%m/%d/%Y")
summary(cdebt_original$thrudate)
cdebt_original$fromdate = as.Date(cdebt_original$fromdate, "%m/%d/%Y") + 365.25 * 2000 - 15
cdebt_original$thrudate = as.Date(cdebt_original$thrudate, "%m/%d/%Y") + 365.25 * 2000 - 15
cdebt_original$debtdate = as.Date(cdebt_original$debtdate, "%m/%d/%Y") + 365.25 * 2000 - 15
summary(cdebt_original$thrudate)
``` 

```{r dates}
with(cdebt_original, plot(thrudate, amount))
```

Following are some additional observations made while in Excel:
    * Many filernames (and filerids) have multiple entries in the table. Consequently, a given person will be counted multiple times if corresponding rows aren't consolidated into a total or set of totals. Notably, a given filername is often associated with a variety of parties and offices. 
    * There are 7 more levels for filerid (141) than for filername (134). This is due to 7 filernames that each have two corresponding filerid values. One possible explanation could be that two or more people who share the same name ran for office. 
    * office2, legislativedistrict, jurisdiction, jurisdictioncounty, and jurisdictiontype are all related to one another -- but do not appear to be related to office. Online searches meanwhile show that of these, only office appears related to filername. 

Last, the dataset contains several variables that appear unlikely to contribute much or any information. 
    * origin, filertype, recordtype: Factor has only one level. Some rows in recordtype are NA, but in these cases whole row is NA.
    * electionyear: All values are either either 2012 or NA
    
Jason to Divya: I think these merit more analysis before including above, i.e., we need to demonstrate what we state.  
    * firstname, middleinitial, lastname: these are presumably redundant to filername 
    * vendoraddress, vendorcity, vendorstate: vendorname might be used in lieu of these 4 variables

```{r origin}
summary(cdebt_all$origin)
``` 
```{r filertype}
summary(cdebt_all$filertype)
``` 
```{r recordtype}
summary(cdebt_all$recordtype)
``` 
```{r electionyear}
summary(cdebt_all$electionyear)
``` 


### Univariate Analysis of Key Variables: Use visualizations and descriptive statistics to perform a univariate analysis of each key variable. Be sure to describe any anomalies, coding issues, or potentially erroneous values. Explain how you respond to each issue you identify. Note any features that appear relevant to statistical analysis. Discuss what transformations may be appropriate for each variable.

The 'amount' values are all positive and range from around 3 to 19,000 (units are unclear but are presumably dollars or perhaps thousands of dollars). The mean is more than 4x the median, and a histogram confirms the distribution is positively skewed.
```{r}
summary(cdebt_all$amount)
hist(cdebt_all$amount, breaks = seq(0, 20000, by = 2000), main = "Histogram of the 'amount' variable",  border="black", col="#00A5DF", xlab = "amount")
```

#### Examine talk about Party

Nearly 65% of filings (by count rather than amount) were by Democrats -- more than twice the number filed by Republicans.  
```{r party}
#qplot(cdebt_all$was_office , main ="number of debts wrt to filer's office") +  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=5))

party <- table(cdebt_all$party)
length(cdebt_all$party)
summary(cdebt_all$party)

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,0.3))

barplot(party[order(party)], horiz = TRUE , las = 1, main ="Number of debts by party" , xlab="No of debts" ,cex.axis = .9 ,cex.names= 0.9 , col = rainbow(16) )

```
#### Examine target variable: office 

Most debt entries (about 51% of total) were filed by state representatives. State senators had the next-largest share, with less than 14% of the total count.
```{r office}
#qplot(cdebt_all$office , main ="number of debts wrt to filer's office") +  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=5))
length(cdebt_all$office)
summary(cdebt_all$office)

office <- table(cdebt_all$office)
#Sets plot margins : b, l, t, r 
par(las=1, mar=c(2.5,8,2, 0.3))

barplot(office[order(office)], horiz = TRUE , las = 1, main ="Number of debts by office", xlab="Number of debts" ,cex.names=0.5 , col = terrain.colors(16)) 

# [order(office)]

```

Nearly 47% of entries are associated with vendorcity of Seattle, followed by Woodinville and Washington, D.C.
```{r vendorcity}
#qplot(cdebt_all$office , main ="number of debts wrt to filer's office") +  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=5))
#length(cdebt_all$vendorcity)
#summary(cdebt_all$vendorcity)
#summary(cdebt_all$vendorstate)
count_Seattle = subset(cdebt_all, vendorcity == "SEATTLE")
count_cities = subset(cdebt_all, !is.na(vendorcity))
(share_Seattle = length(count_Seattle$vendorcity) / length(count_cities$vendorcity))

vendorcity <- table(cdebt_all$vendorcity)
#Sets plot margins : b, l, t, r 
par(las=1, mar=c(2.5,8,2, 0.3))

barplot(vendorcity[order(vendorcity)], horiz = TRUE , las = 1, main ="Number of debts by vendorcity", xlab="Number of debts" ,cex.names=0.5 , col = terrain.colors(16)) 


```

Fully 25% of entries have "RE-ORDER TEE SHIRTS" in the description field. 
```{r description}
#qplot(cdebt_all$office , main ="number of debts wrt to filer's office") +  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=5))
length(cdebt_all$description)
summary(cdebt_all$description)

#description <- table(cdebt_all$description)
#Sets plot margins : b, l, t, r 
#par(las=1, mar=c(2.5,8,2, 0.3))

#barplot(description[order(description)], horiz = TRUE , las = 1, main ="Number of debts by vendorstate", xlab="Number of debts" ,cex.names=0.5 , col = terrain.colors(16)) 


```

## Analysis of Key Relationships: Explore how your outcome variable is related to the other variables in your dataset. Make sure to use visualizations to understand the nature of each bivariate relationship. What tranformations can you apply to clarify the relationships you see in the data? Be sure to justify each transformation you use.

Notably, if 'reportnumber' is coerced from int to factor, it becomes apparent that each value is unique (# of levels = # of observations).
```{r reportnumber}
str(as.factor(cdebt_original$reportnumber))
``` 
```{r}
# Jason to Divya: I just added this -- interestingly, there seems to be a surge in debts in the middle of the range, presumably due to reportnumber increasing with time. 
with(cdebt_all, plot(reportnumber, amount))
```

#### Examine the target variable: Amount wrt to Party

Lets first examine Total Amount wrt to Party :

Most of the debt is filed by Democrats -- more than 9x the amount filed by Republicans. The aforementioned 2x difference in filing count does not explain the gap between parties.
```{r amount_sum}
(amount_sum = tapply(cdebt_all$amount, cdebt_all$party, FUN=sum))
```

```{r totalDebtVsParty}
#qplot(cdebt_all$was_office , main ="number of debts wrt to filer's office") +  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=5))

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,0.3))

barplot(amount_sum[order(amount_sum)], horiz = TRUE , las = 1, main ="Total Debt wrt to Party" , xlab="Total Debt" ,cex.axis = .9 ,cex.names= 0.9 , col = rainbow(16), xpd = FALSE)
?barplot

# display in K

```

To better assess this relationship, we will plot the mean amount for each party.  We can use a by statement to get the means.

```{r meanAmountVsParty}

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,0.3))

amount_means = by(cdebt_all$amount, cdebt_all$party,  mean)
amount_means

#ggplot(cdebt_all, aes(x=cdebt_all$party, y=cdebt_all$was_office)) + geom_boxplot(outlier.colour="red")
barplot(amount_means[order(amount_means)], horiz = TRUE , las = 1, main ="Mean Debt wrt to Party" , xlab="Mean Debt" ,cex.axis = .9 ,cex.names= 0.9 , col = rainbow(16) ) 

```

Let's check the distribution of debt amount through a boxplot 

```{r debtDistriVsParty}

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(5,10,2,0.3))

boxplot(cdebt_all$amount ~ party,  horizontal = TRUE ,data = cdebt_all, cex.axis = .6, log='x',
main = " Debt distirbution wrt to party", col = "#BA554C")
  
?boxplot

#ggplot(cdebt_all, aes(x=cdebt_all$party, y=cdebt_all$was_office)) + geom_boxplot(outlier.colour="red")

```

1. We notice that Democrats and Non partisan parties have contributed to
   most of the debt amount

2. Republican party has some outliers 

3. Though there are more no of debts for republicans the amount of debt is distributed around 450$
   R code to show the amount of debt
   
Next we would look at the relationship between the office sought by the candidate and the amount of debt incurred or order placed

#### Examine the relationships between office and Debt Amount

```{r amountvsoffice}

#Sets outside margins : b, l, t, r 
par(las=1, mar=c(10,4,2,0.3))

boxplot(cdebt_all$amount ~ office, data = cdebt_all, cex.axis = .6, log='y',
main = " Debt distirbution wrt to office" , las=2 , col = "#DDA266")
  
?boxplot

var(cdebt_all$amount, na.rm = TRUE) 

?var

#ggplot(cdebt_all, aes(x=cdebt_all$amount, y=cdebt_all$was_office)) + geom_boxplot(outlier.colour="red")

```


```{r}
summary(cdebt_all$amount)
```
##### Bivariate Analysis

1. We noticed though state representative has more number of debts , but
   the total amount is between $5 to $1000 with the maximum debt amount between $300 and $750 
   in the interquartile region

2. Median of the debt amount is at $300 as confirmed by the boxplots

3. The boxplots indicate that the debt amounts are almost around the same interquartile region
   which means that the debt amount for all the candidates are in the same range irrespective of their served offices 


## Analysis of Secondary Effects: What secondary variables might have confounding effects on the relationships you have identified? Explain how these variables affect your understanding of the data.

## Exploratory Analysis

## Scatterplot Matrix 
[Divya] : Dont think this plot is required at all 

When we have a large number of variables, we often begin with a scatterplot matrix. This is helpful for getting a high-level overview of the relationships between our variables and can draw our attention to important features we want to investigate further.

[Divya] : Guess these scatterplots are not relevant to categorical variables , the below would be considered as chart junk

```{r relationships}

#summary(cdebt_all$position)

#scatterplotMatrix( ~ filerid + legislativedistrict + position + amount , data = cdebt_all, diagonal = "histogram", main = "Scatterplot Matrix for filer id and int Variables wrt Debt ")

#scatterplotMatrix( ~ office + office2 + party  + amount , data = cdebt_all, diagonal = "histogram", main = "Scatterplot Matrix wrt Debt ")

#scatterplotMatrix( ~ jurisdiction + jurisdictioncounty + jurisdictiontype  + amount , data = cdebt_all, diagonal = "histogram", main = "Scatterplot Matrix for jurisdiction wrt Debt ")

#scatterplotMatrix( ~ fromdate + thrudate +  debtdate + amount , data = cdebt_all, diagonal = "histogram", main = "Scatterplot Matrix for next 3 Key Variables wrt Amount")

#scatterplotMatrix(~ code + description + vendorname  + amount , data= cdebt_all, diagonal = "histogram", main = "Scatterplot Matrix type of Debt")

```

Jason to Divya: I've moved some of your text down here for now to tidy up. 

[Divya] : Jason Delete the below

Since we are trying to understand how campaign characteristics are related to the candidates debt, we look into the last row and last column where amount represents the x-axis and the other categorical variables represent the y-axis.

We noticed the following relationship between amount and the other variables:
 * filerid  : We noticed that The filerid and amount dont have any obvious relationship
 * legislativedistrict : We noticed that legislative district has categorical values , which indicate no obvious relationship with amount
 * position : There is some relationship , should evaluate ???
 
#### Examine target variable: amount (i.e., the debt amount)

[Divya] : Just notes
Now we need define what are the variables that define our campaign characteristics
Looking at the data the variables are (wrt to amount)

1. Party  : Party he ran for 
2. office : office he ran for
3. jurisdiction county : for which county he ran for
4. jurisdiction : for which jurisdiction
5. jurisdiction type : for which juridisction type

Secondary effects can be analysed through below variables(wrt to amount)
1. code : Many N/A and blanks
2. description : Description could be worded differently for the same kind of debt
3. vendor name : can give some insights


[Divya Notes] : 
Total Amount of Debt by Party, Mean Debt by Party
Total Amount of Debt by Office and Party combo, Mean amount of debt by Office and Party Combo
Debt by Area (County)
